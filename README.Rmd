---
output:
  md_document:
    variant: markdown_github
---
```{r Setup, include=FALSE}
library(rwavelet)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "inst/doc/readme_img/"
)
```
# rwavelet

[![Build Status](https://travis-ci.org/fabnavarro/rwavelet.svg)](https://travis-ci.org/fabnavarro/rwavelet)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/rwavelet)](http://cran.r-project.org/package=rwavelet)
![CRAN Downloads](http://cranlogs.r-pkg.org/badges/rwavelet)

Wavelet Analysis

## Download and Install

Install the devtools package if you haven't already.
```{r, eval=FALSE}
install.packages("devtools")
```

To install the development package, type the following at the R command line:
```{r, eval=FALSE}
devtools::install_github("fabnavarro/rwavelet")
library(rwavelet)
```

To install the CRAN version of the package, type the following:
```{r, eval=FALSE}
install.packages("rwavelet")
```

## General features

* 1d, 2d and 3d MRA Forward/Inverse Wavelet Transforms Periodized Orthogonal (FWT_PO, IFWT_PO)
* 1d, 2d tensor Forward/Inverse Wavelet Transform Periodized Orthogonal (FTWT_PO, ITWT_PO)
* 1d, 2d Translation Invariant Forward/Inverse Wavelet Transform (FWT_TI, IWT_TI, also know as redundant wavelet transform, maximal overlap wavelet transform, undecimated wavelet transform or stationary wavelet transform)
* Linear wavelet estimation/approximation (using 2 fold cross validation, CVLinear)
* Non linear wavelet estimation/approximation (hard and soft thresholding, can be easily extended to other thresholding rules)
* 1d Wavelet Block Thresholding estimation/approximation
* ...

To obtain the complete list of package functions, simply type 
```{r, eval=FALSE}
help(package = "rwavelet")
```

## Getting Started

Here is an example of denoising of an experimental nuclear magnetic resonance (NMR) spectrum. We start by loading the data:
```{r}
data("RaphNMR")
Y <- RaphNMR
n <- length(Y)
t <- seq(0, 1, length = n)
```

Then we specify the coarse decomposition scale $j_0$, the wavelets we want to use (here, Symmlet with 6 vanishing moments) and we perform a fast wavelet transform to get the noisy wavelet coefficients (Ywd):
```{r}
j0 <- 0
J <- log2(n)
qmf <- MakeONFilter('Symmlet', 6)
Ywd <- FWT_PO(Y, j0, qmf)
Ywnoise <- Ywd
```

We estimate $\sigma$ the standard deviation of the noise using the maximum absolute deviation (with only the finest scale coefficients). We apply a hard thresholding rule (with a universal threshold) to the coefficient estimators and obtain the estimator by applying an inverse transform:
```{r}
hatsigma <- MAD(Ywd[(2^(J-1)+1):2^J])
lambda <- sqrt(2*log(n))*hatsigma
Ywd[(2^(j0)+1):n] <- HardThresh(Ywd[(2^(j0)+1):n], lambda)
fhat <- IWT_PO(Ywd, j0, qmf)
```

Finally, we plot the resulting estimator:
```{r, NMR, fig.width=8, fig.height=5}
par(mfrow=c(2,2), mgp = c(1.2, 0.5, 0), tcl = -0.2,
    mar = .1 + c(2.5,2.5,1,1), oma = c(0,0,0,0))
plot(t,Y,xlab="", ylab="", main="Observations")
plot(t,Y,xlab="", ylab="", main="Observations and Estimator")
matlines(t, fhat, lwd=2, col="blue", lty=1)
plot(Ywnoise, ylim=c(-20, 20), xlab="", ylab="", main = "Noisy Coefficients")
matlines(rep(lambda, n), lwd=2,col="red",lty=1)
matlines(-rep(lambda, n), lwd=2,col="red",lty=1)
plot(Ywd, ylim=c(-20,20), xlab="", ylab="", main = "Estimated Coefficients")
```

See the [package vignette](http://fnavarro.perso.math.cnrs.fr/rpackage/rwaveletvignette.html) for more details.
You could also build and see the vignette associated with the package using the following lines of code
```{r, eval=FALSE}
devtools::install_github("fabnavarro/rwavelet", build_vignettes = TRUE)
library(rwavelet)
```

Then, to view the vignette
```{r, eval=FALSE}
vignette("rwaveletvignette")
```

## How to cite
```{r Cite me}
citation("rwavelet")
```
